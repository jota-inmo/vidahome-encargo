
import type { FormData } from '../types';

declare const jspdf: any;
declare const QRCode: any;

export const generatePdf = (formData: FormData, isPreview = false) => {
  const { jsPDF } = jspdf;
  const doc = new jsPDF({ unit: 'pt', format: 'a4' });
  const m = 48, fullW = 595 - m * 2;
  let y = m;

  const getAgent = () => {
    if (formData.agente === 'Otro (especificar)') return formData.agente_otro || '(indicar)';
    return formData.agente || '(sin agente)';
  };
  
  // Header
  const logoBase64 = "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";
  const companyInfo = 'Vida Home Gandia S.L. · CIF B75472027 · C/ Joan XXIII nº1 · 46730 Grau de Gandía · 960 519 214';
  const modeTitle = formData.categoria === 'A' ? 'de alquiler' : 'de venta';
  const titleText = `Encargo de gestión ${modeTitle} SIN EXCLUSIVA`;

  // --- Header ---
  try {
    doc.addImage(logoBase64, 'PNG', m, y, 144, 42.5);
  } catch(e) {
    console.error("Error adding logo image:", e);
    // Continue without logo if it fails
  }
  
  doc.setFontSize(14);
  doc.setFont('helvetica', 'bold');
  doc.text(titleText, m + 160, y + 20);
  
  doc.setFontSize(7);
  doc.setFont('helvetica', 'normal');
  doc.text(companyInfo, m + 160, y + 35);

  y += 80;
  
  // --- Form data ---
  doc.setFontSize(12);
  doc.setFont('helvetica', 'bold');
  doc.text('1) Datos de gestión', m, y);
  y += 20;

  doc.setFontSize(10);
  doc.setFont('helvetica', 'normal');
  doc.text(`Referencia: ${formData.ref}`, m, y);
  doc.text(`Fecha del encargo: ${new Date(formData.fecha).toLocaleDateString('es-ES')}`, m + fullW / 2, y);
  y += 15;
  doc.text(`Agente: ${getAgent()}`, m, y);
  doc.text(`Modalidad: ${formData.categoria === 'A' ? 'Alquiler (A)' : 'Venta'}`, m + fullW / 2, y);
  y += 25;
  
  // --- More sections can be added here following the same pattern ---
  // Example: doc.text('2) Propietarios', m, y); etc.
  
  if (isPreview) {
    doc.output('dataurlnewwindow');
  } else {
    doc.save(`encargo_${formData.ref || 'sin-ref'}.pdf`);
  }
};
